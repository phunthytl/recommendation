{% extends "layout.html" %}
{% block content %}

<div class="row">
    <div class="col-md-4">
        <img src="{{ anime.image }}" class="img-fluid rounded shadow">
    </div>

    <div class="col-md-8">
        <h2>{{ anime.title }}</h2>
        <p><b>Thể loại:</b> {{ anime.genres }}</p>
        <p><b>Hạng:</b> {{ anime.popularity }}</p>
        <p><b>Điểm:</b> {{ anime.score }}</p>
        <p><b>Số tập:</b> {{ anime.episodes }}</p>
        <p><b>Trạng thái:</b> {{ anime.status }}</p>
        <p><b>Lượt yêu thích:</b> {{ anime.favorites }}</p>

        <h4>Đánh giá anime:
        {% if user_rating %}
            <span class="ms-2"><b>{{ user_rating }}/10</b></span>
        {% endif %}
        </h4>

        {% if user_rating %}
            <a href="/rate/delete/{{ anime.id }}" class="btn btn-danger btn-sm mb-2"><i class="fas fa-trash-alt me-1"></i>Xóa đánh giá</a>
        {% else %}
            <p>Bạn chưa đánh giá anime này.</p>
        {% endif %}

        <div class="rating-buttons">
            {% for i in range(1, 11) %}
                <a href="/rate/{{ anime.id }}/{{ i }}"
                class="rate-btn {% if user_rating == i %}active-rate{% endif %}">
                    {{ i }}
                </a>
            {% endfor %}
        </div>

    </div>
</div>

<hr>

<p><b>Mô tả:</b> {{ anime.synopsis_clean }}</p>

<hr>

<h3>Gợi ý anime tương tự (Content-Based Filtering)</h3>

<div class="row g-4 mt-2">
    {% for a in recommendations %}
    <div class="col-6 col-md-3 col-lg-2">
        <div class="card anime-card h-100">
            <img src="{{ a.image }}" class="card-img-top">
            <div class="card-body text-center d-flex flex-column">
                <a href="/anime/{{ a.id }}" class="anime-title-link">{{ a.title }}</a>
                <p class="text-muted small flex-grow-1">{{ a.genres }}</p>
                {% if a.score %}
                    <p class="badge bg-info"><i class="fas fa-chart-pie me-1"></i>Tương đồng: {{ "%.1f"|format(a.score * 100) }}%</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
