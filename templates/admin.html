{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4">üìä Admin Dashboard ‚Äì T·ªïng h·ª£p h·ªá g·ª£i √Ω</h2>

<!-- ========================= -->
<!-- TH·ªêNG K√ä C∆† B·∫¢N -->
<!-- ========================= -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>T·ªïng Anime</h6>
            <h3>{{ total_items }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>T·ªïng User</h6>
            <h3>{{ total_users }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>L∆∞·ª£t Y√™u Th√≠ch</h6>
            <h3>{{ total_fav }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>T·ªïng ƒê√°nh Gi√° (Rating)</h6>
            <h3>{{ total_rating }}</h3>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>User ƒë√£ ƒë√°nh gi√°</h6>
            <h3>{{ users_with_rating }}</h3>
        </div>
    </div>
</div>

<hr>

<!-- ========================= -->
<!-- BI·ªÇU ƒê·ªí -->
<!-- ========================= -->
<h3 class="mb-3">üìà Tr·ª±c quan d·ªØ li·ªáu</h3>

<div class="row mb-4">

    <div class="col-md-3 mb-3">
        <div class="card p-2 shadow-sm">
            <h6 class="text-center">Ph√¢n b·ªë Score</h6>
            <img src="data:image/png;base64,{{ score_img }}" class="img-fluid rounded">
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card p-2 shadow-sm">
            <h6 class="text-center">Top Genres</h6>
            <img src="data:image/png;base64,{{ genres_img }}" class="img-fluid rounded">
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card p-2 shadow-sm">
            <h6 class="text-center">Top Favorites</h6>
            <img src="data:image/png;base64,{{ fav_img }}" class="img-fluid rounded">
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card p-2 shadow-sm">
            <h6 class="text-center">Heatmap t∆∞∆°ng quan</h6>
            <img src="data:image/png;base64,{{ heatmap_img }}" class="img-fluid rounded">
        </div>
    </div>

</div>

<hr>

<!-- ========================= -->
<!-- TH·ªêNG K√ä THEO RATING -->
<!-- ========================= -->
<h3 class="mb-3">‚≠ê Th·ªëng k√™ theo Rating</h3>

<h5 class="mt-3">üî∑ Anime ƒë∆∞·ª£c ƒë√°nh gi√° nhi·ªÅu nh·∫•t</h5>
<div class="row mb-4">
    {% for a in top_rated %}
    <div class="col-6 col-md-3 col-lg-2">
        <div class="card anime-card shadow-sm">
            <img src="{{ a.image }}" class="card-img-top">
            <div class="card-body text-center">
                <b>{{ a.title }}</b>
                <p class="text-muted small">L∆∞·ª£t ƒë√°nh gi√°: {{ a.count }}</p>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<h5 class="mt-3">üî∂ Anime c√≥ ƒëi·ªÉm trung b√¨nh cao nh·∫•t</h5>
<div class="row mb-4">
    {% for a in avg_rating %}
    <div class="col-6 col-md-3 col-lg-2">
        <div class="card anime-card shadow-sm">
            <img src="{{ a.image }}" class="card-img-top">
            <div class="card-body text-center">
                <b>{{ a.title }}</b>
                <p class="text-muted small">ƒêi·ªÉm TB: {{ a.mean|round(2) }} ({{ a.count }} ratings)</p>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<hr>

<!-- ========================= -->
<!-- TR·∫†NG TH√ÅI MODEL -->
<!-- ========================= -->
<h3 class="mb-3">üß† Tr·∫°ng th√°i m√¥ h√¨nh CF SVD</h3>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>Model Status</h6>
            <h4>{{ model_status }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>User trong model</h6>
            <h4>{{ num_cf_users }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>Anime trong model</h6>
            <h4>{{ num_cf_items }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>Latent factors</h6>
            <h4>{{ num_factors }}</h4>
        </div>
    </div>
</div>

<hr>

<h3 class="mb-3">üßÆ ƒê√°nh gi√° m√¥ h√¨nh Recommender</h3>

<h5 class="mt-3">üî∑ Collaborative Filtering (SVD)</h5>
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>RMSE</h6>
            <h4>{{ rmse|round(3) }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>MAE</h6>
            <h4>{{ mae|round(3) }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>Precision@10</h6>
            <h4>{{ cf_precision|round(3) }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>Recall@10</h6>
            <h4>{{ cf_recall|round(3) }}</h4>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>Coverage</h6>
            <h4>{{ cf_cov|round(3) }}</h4>
        </div>
    </div>
</div>

<hr>

<h5 class="mt-4">üî∂ Content-Based (TF-IDF)</h5>
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>Precision@10</h6>
            <h4>{{ cb_precision|round(3) }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6>Recall@10</h6>
            <h4>{{ cb_recall|round(3) }}</h4>
        </div>
    </div>
</div>


{% endblock %}
