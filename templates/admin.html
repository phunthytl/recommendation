{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4"><i class="fas fa-chart-bar me-2" style="color: #17a2b8;"></i>Admin Dashboard – Tổng hợp hệ gợi ý</h2>

<!-- ========================= -->
<!-- THỐNG KÊ CƠ BẢN -->
<!-- ========================= -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-film me-2"></i>Tổng Anime</h6>
            <h3>{{ total_items }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-users me-2"></i>Tổng User</h6>
            <h3>{{ total_users }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-star me-2"></i>Tổng Đánh Giá (Rating)</h6>
            <h3>{{ total_rating }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-user-check me-2"></i>User đã đánh giá</h6>
            <h3>{{ users_with_rating }}</h3>
        </div>
    </div>
</div>

<hr>

<!-- ========================= -->
<!-- BIỂU ĐỒ -->
<!-- ========================= -->
<h3 class="mb-3">
    <i class="fas fa-chart-line me-2 text-success"></i>Trực quan dữ liệu
</h3>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-light">
        <ul class="nav nav-tabs card-header-tabs" role="tablist">

            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#cf-data">
                    <i class="fas fa-users me-2"></i>Dữ liệu đánh giá (CF)
                </button>
            </li>

            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#content-data">
                    <i class="fas fa-tags me-2"></i>Nội dung Anime
                </button>
            </li>

            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#popular-data">
                    <i class="fas fa-fire me-2"></i>Độ phổ biến
                </button>
            </li>

        </ul>
    </div>

    <div class="card-body tab-content">

        <!-- ================= CF DATA ================= -->
        <div class="tab-pane fade show active" id="cf-data">
            {{ rating_dist_img|safe }}
            <hr>
            {{ user_activity_img|safe }}
        </div>

        <!-- ================= CONTENT DATA ================= -->
        <div class="tab-pane fade" id="content-data">
            {{ genres_img|safe }}
            <hr>
            {{ heatmap_img|safe }}
            <hr>
            {{ genre_overlap_img|safe }}
        </div>

        <!-- ================= POPULARITY ================= -->
        <div class="tab-pane fade" id="popular-data">
            {{ item_popularity_img|safe }}
            <hr>
            {{ top_rated_count_img|safe }}
        </div>

    </div>
</div>

<hr>

<!-- ========================= -->
<!-- TRẠNG THÁI MODEL -->
<!-- ========================= -->
<h3 class="mb-3"><i class="fas fa-brain me-2" style="color: #e83e8c;"></i>Trạng thái mô hình CF SGD</h3>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-check-circle me-2"></i>Model Status</h6>
            <h4>{{ model_status }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-user me-2"></i>User trong model</h6>
            <h4>{{ num_cf_users }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-images me-2"></i>Anime trong model</h6>
            <h4>{{ num_cf_items }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-sliders-h me-2"></i>Latent factors</h6>
            <h4>{{ num_factors }}</h4>
        </div>
    </div>
</div>

<hr>

<h3 class="mb-3"><i class="fas fa-chart-area me-2" style="color: #20c997;"></i>Đánh giá mô hình Recommender</h3>

<h5 class="mt-3"><i class="fas fa-diamond me-2" style="color: #6f42c1;"></i>Collaborative Filtering (SVD)</h5>
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-calculator me-2"></i>RMSE</h6>
            <h4>{{ rmse|round(3) }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-calculator me-2"></i>MAE</h6>
            <h4>{{ mae|round(3) }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-bullseye me-2"></i>Precision@10</h6>
            <h4>{{ cf_precision|round(3) }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-crosshairs me-2"></i>Recall@10</h6>
            <h4>{{ cf_recall|round(3) }}</h4>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-expand me-2"></i>Coverage</h6>
            <h4>{{ cf_cov|round(3) }}</h4>
        </div>
    </div>
</div>

<hr>

<h5 class="mt-4"><i class="fas fa-gem me-2" style="color: #fd7e14;"></i>Content-Based (TF-IDF)</h5>
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-bullseye me-2"></i>Precision@10</h6>
            <h4>{{ cb_precision|round(3) }}</h4>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow-sm">
            <h6><i class="fas fa-crosshairs me-2"></i>Recall@10</h6>
            <h4>{{ cb_recall|round(3) }}</h4>
        </div>
    </div>
</div>

{% endblock %}
